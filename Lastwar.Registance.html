<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>라스트 워 내성 검색기</title>
  <style>
body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f4;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

.container {
  background-color: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  max-width: 500px;
  width: 90%;
  text-align: center;
}

h1 {
  font-size: 1.6em;
  color: #222;
  margin-bottom: 20px;
}

.input-group {
  margin-bottom: 15px;
  text-align: left;
}

.input-row {
  display: flex;
  align-items: flex-end; /* 라벨은 위, 인풋은 아래 맞춤 */
  gap: 10px;
}

.sub-input {
  display: flex;
  flex-direction: column;
  width: 100px;
}

.slide {
  flex: 1;
}

.sub-input label {
  font-weight: bold;
  color: #333;
  margin-bottom: 4px;
  font-size: 0.9em;
}

.sub-input input {
  height: 44px;
  padding: 0 10px;
  font-size: 1em;
  border: 1.5px solid #007BFF;
  border-radius: 6px;
  box-sizing: border-box;
}

.step-buttons {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 3px;
  margin-left: -6px;
  margin-right: 6px;
}

.step-buttons button {
  width: 30px;
  height: 20px;
  font-size: 10px;
  cursor: pointer;
  border: 1px solid #007BFF80;
  background-color: #f8f9fa;
  border-radius: 4px;

  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

.search-btn {
  width: 100px;
  height: 44px;
  background-color: #007BFF;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 1em;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}

.search-btn:hover {
  background-color: #0056b3;
}

.search-btn:active {
  transform: scale(0.98);
}


#results-container {
  margin-top: 20px;
  text-align: left;
}

.result-item {
  padding: 8px 10px;
  display: flex;
  justify-content: space-between;
}

.result-item:nth-child(odd) {
  background-color: #f9f9f9;
}

.result-item strong {
  
}

.percent-high {
  font-weight: bold;
  color: #28a745; /* 높은 퍼센트는 초록 */
}
.percent-mid {
  font-weight: bold;
  color: #4527f5; /* 높은 퍼센트는 빨강 */
}
.percent-low {
  color: #939393; /* 낮은 퍼센트는 회색 */
}

#myPower {
  margin-top: -8px;
}

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}


</style>
</head>
<body>

  <div class="container">
    <h1>내성 구간 검색기</h1>
	<div class="input-group">
	  <div class="input-row">
		<!-- 첫 번째 입력 그룹 -->
		<div class="sub-input">
		  <label for="opponentResistance">상대 보스 내성</label>
		  <input type="number" id="opponentResistance" 
				 placeholder="예: 3500, 4500, 5500" 
				 value="3500" step="250" min="0">
		</div>

		<!-- 스텝 버튼 -->
		<div class="step-buttons">
		  <button type="button" onclick="stepUp(1)">▲</button>
		  <button type="button" onclick="stepDown(1)">▼</button>
		</div>

		<!--
		<div class="sub-input">
		  <label for="myPower" id="myPowerLabel">내 전투력</label>
		  <input type="number" id="myPower" placeholder="내 전투력 입력" min="0" value="10000000" step="100000">
		</div>

		<div class="step-buttons">
		  <button type="button" onclick="stepUp(2)">▲</button>
		  <button type="button" onclick="stepDown(2)">▼</button>
		</div>
		-->
		<div class="sub-input slide">
		  <label for="myPower" id="myPowerLabel">내 전투력</label>
		  <input type="range" id="myPower" min="0" max="100000000" step="100000" value="10000000">
		</div>

		

		<!-- 검색 버튼 -->
		<button class="search-btn" onclick="findResistances()">내성 검색</button>
	  </div>
	</div>


    <div id="results-container"></div>
  </div>

  <script>
	const opponentResistanceInput = document.getElementById('opponentResistance');
	const myPowerInput = document.getElementById('myPower');
	const myPowerLabel = document.getElementById('myPowerLabel');

	function updateLabel() {
	  let value = parseFloat(myPowerInput.value);
	  if (!isNaN(value)) {
		let millionValue = (value / 1000000).toFixed(1);
		myPowerLabel.textContent = "내 전투력 : " + millionValue + "M";
	  } else {
		myPowerLabel.textContent = "내 전투력 : 0.0M";
	  }
	}

	// 입력할 때마다 실시간 반영
	myPowerInput.addEventListener('input', updateLabel);

	// 페이지 로드 시 기본값 반영
	document.addEventListener('DOMContentLoaded', function() {
		load();
		updateLabel();
	});


	function stepUp(type) {
		if (type == 1) {
			opponentResistanceInput.stepUp();
		} else if (type == 2) {
			myPowerInput.stepUp();
			updateLabel();
		}
	}
	
	function stepDown(type) {
		if (type == 1) {
			opponentResistanceInput.stepDown();
		} else if (type == 2) {
			myPowerInput.stepDown();
			updateLabel();
		}
	}

    function calculateDamagePercentage(currentResistance, requiredResistance) {
      if (currentResistance >= requiredResistance) {
        return 100.0;
      }
      const missingResistance = requiredResistance - currentResistance;
      const missingResistancePercent = (missingResistance / requiredResistance) * 100;
      const roundedMissingPercent = Math.ceil(missingResistancePercent);
      const initialDamagePercent = 100 - (2 * roundedMissingPercent);

      if (initialDamagePercent > 0) {
        return parseFloat(initialDamagePercent.toFixed(1));
      } else {
        const floorCalculation = (initialDamagePercent / 20) + 1;
        const finalDamagePercent = Math.max(0.1, floorCalculation);
        return parseFloat(finalDamagePercent.toFixed(1));
      }
    }

    function findResistances() {
		const requiredRes = parseFloat(document.getElementById('opponentResistance').value);
		const resultsContainer = document.getElementById('results-container');
		resultsContainer.innerHTML = '';

		if (isNaN(requiredRes) || requiredRes <= 0) {
			resultsContainer.innerHTML = '<div class="result-item">유효한 보스 내성을 입력해주세요.</div>';
			return;
		}

		const MIN_PERCENT = 0.1;
		const MAX_PERCENT = 100.0;
		const power = myPowerInput.value;
		let found = false;
		let myRes = 0;
		while(myRes<=requiredRes+500) {
			myRes += 250;
			const damagePercent = calculateDamagePercentage(myRes, requiredRes);

			if (damagePercent >= MIN_PERCENT && damagePercent <= MAX_PERCENT) {
				if (damagePercent == 0.1 && resultsContainer.lastChild) {
					resultsContainer.removeChild(resultsContainer.lastChild);
				}
				found = true;
				const item = document.createElement('div');
				item.classList.add('result-item');

				const percentClass = damagePercent < 5 ? 'percent-low' : damagePercent >= 50 ? 'percent-high' : 'percent-mid';
				item.innerHTML = `<strong class="${percentClass}">${myRes}</strong> <span class="${percentClass}">${(power*damagePercent/100/1000000).toFixed(1)}M (${damagePercent.toFixed(1)}%)</span><span class="${percentClass}">(${(damagePercent-100).toFixed(1)}%)</span>`;
				resultsContainer.appendChild(item);

				if (damagePercent >= 100)
					break;
			}
		}
		if (!found) {
			resultsContainer.innerHTML = '<div class="result-item">해당 구간에 맞는 내성(250 배수)이 없습니다.</div>';
		}
		save();
    }
	function save() {
		localStorage.setItem('opponentResistance', opponentResistanceInput.value);
		localStorage.setItem('myPower', myPowerInput.value);
	}
	function load() {
		if (localStorage.getItem('opponentResistance'))
			opponentResistanceInput.value = localStorage.getItem('opponentResistance');
		if (localStorage.getItem('myPower'))
			myPowerInput.value = localStorage.getItem('myPower');
	}
  </script>

</body>
</html>
